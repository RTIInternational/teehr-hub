kind: Build
type: container
name: prefect-teehr-image
description: Build TEEHR Prefect workflow deployer image
spec:
  dockerfile: Dockerfile.prefect-teehr
  buildArgs:
      TEEHR_VERSION: ${var.currentTeehrVersion}
disabled: ${environment.name != 'local'}
---
kind: Deploy
type: kubernetes
name: prefect-workflow-deploy
description: K8s Deploy Prefect Workflows
spec:
  files: ["./manifests/prefect-deployer-job.yaml"]
dependencies: [deploy.prefect-server, build.prefect-teehr-image, build.teehr-spark-executor-image]
---
kind: Deploy
type: kubernetes
name: update-job-template
description: Update job template
spec:
  files: ["./manifests/update-job-template.yaml"]
dependencies: ["deploy.prefect-server", "deploy.prefect-worker"]