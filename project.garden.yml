apiVersion: garden.io/v1
kind: Project
name: teehr-hub
defaultEnvironment: local

variables:

environments:
  - name: local
    defaultNamespace: ${project.name}
    variables:
      hostname: teehr.local.app.garden
      devTeehrVersion: 8968b5f26585d7dad36c3432840d26bdc8a2ed38
      stableTeehrVersion: place-holder # Needed for sync to work for some reason.
      iceberg:
        inCluster: "true"
        catalogS3PathStyleAccess: "true"
        catalogS3Endpoint: "http://minio:9000"
        catalogType: rest
        catalogUri: http://iceberg-rest:8181
        catalogWarehouse: s3://warehouse/
      trino:
        host: trino
        port: "8080"
        user: teehr
        catalog: iceberg
        schema: teehr
      allowedOrigins: "https://dashboards.${var.hostname},https://api.${var.hostname}"
  - name: remote
    defaultNamespace: ${project.name}
    variables:
      hostname: teehr.rtiamanzi.org
      devTeehrVersion: 8968b5f26585d7dad36c3432840d26bdc8a2ed38
      stableTeehrVersion: v0.5.3
      previousTeehrVersion: v0.5.0
      iceberg:
        inCluster: "false"
        catalogS3PathStyleAccess: "false"
        catalogS3Endpoint: ""
        catalogUri: http://iceberg-rest:8181
        catalogType: rest
        catalogWarehouse: s3://dev-teehr-iceberg-warehouse/
      nfsServerDns: "fs-0cb715f5b7a76e862.efs.us-east-2.amazonaws.com"
      trino:
        host: trino
        port: "8080"
        user: teehr
        catalog: iceberg
        schema: teehr
      allowedOrigins: "https://dashboards.${var.hostname},https://api.${var.hostname}"
providers:
  # The name of the provider plugin to use.
  - name: local-kubernetes
    namespace: ${environment.namespace}
    environments: ["local"]
    setupIngressController: false
    deploymentRegistry:
      hostname: localhost:5001
      namespace: ${project.name}
    context: kind-kind
  - name: kubernetes
    namespace: ${environment.namespace}
    environments: ["remote"]
    imagePullSecrets:
      - name: ecr-config
        namespace: default
    deploymentRegistry:
      hostname: 935462133478.dkr.ecr.us-east-2.amazonaws.com
      namespace: ${project.name}
    context: arn:aws:eks:us-east-2:935462133478:cluster/teehr-hub
    buildMode: cluster-buildkit
    defaultHostname: teehr.rtiamanzi.org